% !TeX program = lualatex

\documentclass{article}
% \documentclass{minimal}
\usepackage[
    paperwidth=63mm, 
    paperheight=88mm,
    margin=0mm,
]{geometry}
\setlength\parindent{0pt}
\setlength{\parskip}{2mm}

% the cmyk option makes it convert rgb color to cmyk space
% this makes the pdf output look more "realistic", but less vibrant
% \usepackage[cmyk]{xcolor}
\usepackage{xcolor}

% makes lua stuff easier
\usepackage{luacode}

% for \NewDocumentCommand
\usepackage{xparse}

% for filler text
\usepackage{lipsum}

% for getting the current date
\usepackage[datesep=/]{datetime2}
\DTMsetdatestyle{mmddyy}

% for textboxes
% this also pulls in tikz as a dependency
\usepackage[fitting, skins]{tcolorbox}

% for length maths shenanigans
\usepackage{calc}

% for tables stuff
\usepackage{tabularx}
\usepackage{array}

% load fonts
\usepackage{fontspec}
\newfontfamily\bodyfont{CrimsonPro-Regular}[
    Path           = "fonts/Crimson_Pro/",
    Extension      = .ttf,
    Ligatures      = TeX,
    Numbers        = Monospaced,
    BoldFont       = CrimsonPro-Bold,
    ItalicFont     = CrimsonPro-Italic,
    BoldItalicFont = CrimsonPro-BoldItalic,
]
\newfontfamily\titlefont{Grenze-Regular}[
    Path           = "fonts/Grenze/",
    Extension      = .ttf,
    Ligatures      = TeX,
    BoldFont       = Grenze-Bold,
    ItalicFont     = Grenze-Italic,
    BoldItalicFont = Grenze-BoldItalic,
    FontFace       = {sb}{n}{Grenze-SemiBold},
    FontFace       = {sb}{it}{Grenze-SemiBoldItalic},
]

\DeclareOldFontCommand{\sbseries}{\fontseries{sb}\selectfont}{\mathbf}
\DeclareTextFontCommand{\textsb}{\sbseries}


% my custom textbox command
\include{textbox.tex}

% card rendering code
\include{card.tex}

\begin{document}

\setpath{Berserker}{000000}{C8000F}
\card[%
    name={Battle Rage},
    cost={},
    permanent,
    text={%
        At the start of each turn, if your opponent has scored at least two 
        points you may play an additional action this turn.
    },
    % path={Berserker},
    % color-left=000000,
    % color-right=C8000F,
]

\setpath{Druid}{00DB1D}{BF00FF}
\card[%
    name={Bind in Thorns},
    cost={WA},
    text={%
        \block
        \attack{1}
    },
]

\setpath{Fireheart}{F44B02}{F9028A}
\newcommand{\burn}[1]{\textcolor[HTML]{F22643}{\textbf{#1}}}

\card[%
    name={Insatiable Flame},
    cost={W},
    text={%
        \attack{1}
        I \burn{burn} your opponent when I hit. \textit{(This can help you set them ablaze)}
    },
]

\card[%
    name={Set Ablaze},
    cost={WWA},
    oneshot,
    text={%
        \attack{4}
        I cost no resources once your opponent has been \burn{burned} twice.
        I can't be blocked.
    },
]

\card[%
    name={Inferno Circle},
    cost={},
    sequence,
    text={%
        \sequence
        [If your opponent attacked this turn, I \burn{burn} them.]
        [If your opponent attacked this turn, I \burn{burn} them.]
    },
]

\card[%
    name={Kindled Flame},
    cost={},
    innate,
    permanent,
    text={%
        When your opponent is \burn{burned} for the third time play Set Ablaze immediately as a special action. If it is banished or forgotten, recall it first.
    },
]

\card[%
    name={Pyre Offering},
    cost={},
    sequence,
    oneshot,
    text={%
        \sequence
        [Banish a non-Fireheart card from your hand to recall Consumed by Flame.]
        [You may play an additional action]
    },
]

\card[%
    name={Consumed by Flame},
    cost={},
    extra,
    text={%
        \textit{This card begins the match forgotten and is recalled by Pyre Offering}

        Consumed by Flame is a copy of the card that was banished by Pyre Offering, except that it \burn{burns} your opponent when it hits and when it blocks their attacks.
    },
]


\setpath{Legionnaire}{FFA500}{AF0301}

\card[%
    name={Balanced Blade},
    cost={A},
    text={%
        \attack{2}
        Recall Parry.
    },
]

\card[%
    name={Parry},
    cost={A},
    extra,
    oneshot,
    text={%
        \textit{This card begins the match forgotten and is recalled by Balanced Blade.}

        I cost one resource less if you played Balanced Blade last turn.
        
        \block
    },
]

\card[%
    name={Arrow Volley},
    cost={SF},
    text={%
        Repeat the following twice:
        \attack{1}

        \textit{(One block can only stop one attack.)}
    },
]

\card[%
    name={Decisive Strike},
    cost={SAA},
    text={%
        I cost one resource less for each two points you've scored this match.
        \attack{3}
    },
]

\card[%
    name={Battle Tactics},
    cost={F},
    innate,
    permanent,
    text={%
        Choose a strategy:

        \textit{Skirmish} -- You may play an additional action on the second turn.

        \textit{Ambush} -- The first time you attack, give an attack +2 attack power.

        \textit{Besiege} -- Your opponent pays {Any}.
    },
]

\card[%
    name={Shield Wall},
    cost={S},
    permanent,
    text={%
        First turn:
        \block

        Whenever you play an attack, block an attack with less attack power.
    },
]


% \setpath{XXX}{aa00aa}{0000aa}
% \card[%
%     name={},
%     type={},
%     cost={},
%     text={%
%         
%     },
% ]


% using luacode* because there are percentage signs
% declare the sqrt function in Lua
% \begin{luacode*}
%     function compute_sqrt(v)
%         local s = math.sqrt(tonumber(v))
%         local s_f = math.floor(s)
%         local o
%         if (math.abs(s_f * s_f - v) < 1.0e-5) then
%             o = string.format("%.1f", s)
%         else
%             o = string.format("%.6f", s)
%         end
%         tex.print(o)
%     end
% \end{luacode*}

% % declare a wrapper in TeX
% \newcommand{\luasqrt}[1]{\directlua{compute_sqrt(#1)}}

% \luasqrt{5}


\end{document} 
